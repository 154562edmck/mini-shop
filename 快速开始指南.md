# âš¡ å¿«é€Ÿå¼€å§‹æŒ‡å—

> åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ã€Šå®‰å…¨å®¡æŸ¥æŠ¥å‘Š.mdã€‹äº†è§£å®‰å…¨é£é™©ï¼

---

## ğŸš¨ ç¬¬ä¸€æ­¥ï¼šå®‰å…¨æ¸…ç†ï¼ˆå¿…åšï¼ï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨æ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/project

# 2. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x å®‰å…¨æ¸…ç†è„šæœ¬.sh

# 3. è¿è¡Œæ¸…ç†è„šæœ¬
./å®‰å…¨æ¸…ç†è„šæœ¬.sh

# 4. æŒ‰æç¤ºè¾“å…¥ yes ç¡®è®¤
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ¸…ç†

```bash
# 1. åˆ é™¤åé—¨æ–‡ä»¶
rm server/common/monitor.js

# 2. ç¼–è¾‘ server/server.js
nano server/server.js
# åˆ é™¤ç¬¬ 16 è¡Œï¼šimport { reportToMonitor } from './common/monitor.js';
# åˆ é™¤ç¬¬ 465 è¡Œï¼šreportToMonitor();

# 3. ä¿®æ”¹å‰ç«¯é…ç½®
nano client/public/config.js
# ä¿®æ”¹æ‰€æœ‰ s7s7s7.cn åŸŸåä¸ºä½ è‡ªå·±çš„åŸŸå

# 4. éªŒè¯æ¸…ç†ç»“æœ
grep -r "s7s7s7" .
grep -r "monitor" server/server.js
```

---

## ğŸ“‹ ç¬¬äºŒæ­¥ï¼šç¯å¢ƒå‡†å¤‡

### ç³»ç»Ÿè¦æ±‚

```
æ“ä½œç³»ç»Ÿ: Ubuntu 22.04 (æ¨è) æˆ–å…¶ä»– Linux
Node.js: >= 18.x
MySQL: >= 8.0
å†…å­˜: >= 2GB
ç¡¬ç›˜: >= 10GB
```

### å®‰è£…å¿…è¦è½¯ä»¶

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node -v  # åº”è¯¥æ˜¾ç¤º v18.x.x
npm -v   # åº”è¯¥æ˜¾ç¤º 9.x.x æˆ–æ›´é«˜

# å®‰è£… PM2
sudo npm install -g pm2

# å®‰è£… MySQL
sudo apt install -y mysql-server

# å¯åŠ¨ MySQL æœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½® MySQL
sudo mysql_secure_installation

# å®‰è£… Nginx
sudo apt install -y nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

---

## ğŸ—„ï¸ ç¬¬ä¸‰æ­¥ï¼šæ•°æ®åº“é…ç½®

```bash
# 1. ç™»å½• MySQL
sudo mysql -u root -p

# 2. åœ¨ MySQL æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE mini_shop 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·ï¼ˆè¯·ä¿®æ”¹å¯†ç ï¼‰
CREATE USER 'shop_user'@'localhost' IDENTIFIED BY 'your_secure_password_here';

-- æˆæƒ
GRANT ALL PRIVILEGES ON mini_shop.* TO 'shop_user'@'localhost';
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

```bash
# 3. å¯¼å…¥æ•°æ®åº“ç»“æ„
cd /path/to/project
mysql -u shop_user -p mini_shop < server/mini_shop.sql

# 4. éªŒè¯å¯¼å…¥æˆåŠŸ
mysql -u shop_user -p mini_shop -e "SHOW TABLES;"
```

---

## ğŸ”§ ç¬¬å››æ­¥ï¼šé…ç½®æ–‡ä»¶

### 1. åç«¯é…ç½®

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨è¿›å…¥å®‰è£…å‘å¯¼ï¼Œæˆ–æ‰‹åŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cd server
nano config.json
```

```json
{
  "db": {
    "host": "localhost",
    "port": 3306,
    "user": "shop_user",
    "password": "your_secure_password_here",
    "database": "mini_shop"
  },
  "admin": {
    "username": "admin",
    "password": "your_admin_password_here"
  }
}
```

### 2. å‰ç«¯é…ç½®

```bash
cd client
nano public/config.js
```

```javascript
window.APP_CONFIG = {
    API_URL: 'http://localhost:4000/v1',  // å¼€å‘ç¯å¢ƒ
    // API_URL: 'https://your-domain.com/v1',  // ç”Ÿäº§ç¯å¢ƒ
    ASSET_PREFIX: 'http://localhost:4001',
    WECHAT_APP_ID: 'your_wechat_appid'
};
```

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šå®‰è£…ä¾èµ–å’Œå¯åŠ¨

### åç«¯

```bash
cd server

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼å¯åŠ¨
npm start

# æˆ–ä½¿ç”¨ PM2 å¯åŠ¨ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
pm2 start npm --name "shop-server" -- start
pm2 save
```

åç«¯å¯åŠ¨åè®¿é—®ï¼š`http://localhost:4000/admin/`

### å‰ç«¯

```bash
cd client

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run dev

# æˆ–ç”Ÿäº§æ¨¡å¼
npm run build
npm start

# æˆ–ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start npm --name "shop-client" -- start
pm2 save
```

å‰ç«¯å¯åŠ¨åè®¿é—®ï¼š`http://localhost:4001/h5/`

---

## ğŸŒ ç¬¬å…­æ­¥ï¼šé…ç½® Nginxï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/shop
```

```nginx
# å‰ç«¯
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:4001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# API åç«¯
server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:4000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/shop /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

---

## ğŸ”‘ ç¬¬ä¸ƒæ­¥ï¼šåˆå§‹åŒ–ç³»ç»Ÿ

### 1. è®¿é—®å®‰è£…å‘å¯¼

å¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œï¼Œè®¿é—®ï¼š`http://your-domain:4000/admin/install.html`

æŒ‰ç…§å‘å¯¼å®Œæˆï¼š
- æ•°æ®åº“é…ç½®æµ‹è¯•
- ç®¡ç†å‘˜è´¦å·åˆ›å»º
- ç³»ç»Ÿåˆå§‹åŒ–

### 2. ç™»å½•ç®¡ç†åå°

è®¿é—®ï¼š`http://your-domain:4000/admin/`

ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•

### 3. é…ç½®ç³»ç»Ÿ

åœ¨ç®¡ç†åå°çš„"ç³»ç»Ÿé…ç½®"ä¸­å®Œæˆä»¥ä¸‹é…ç½®ï¼š

#### å¿…å¡«é…ç½®ï¼š
- **å¾®ä¿¡é…ç½®**
  - AppID
  - AppSecret
  
- **æ”¯ä»˜é…ç½®**ï¼ˆæ ¹æ®éœ€è¦é€‰æ‹©ï¼‰
  - å¾®ä¿¡æ”¯ä»˜ï¼šå•†æˆ·å·ã€è¯ä¹¦ã€å¯†é’¥
  - æ”¯ä»˜å®ï¼šAppIDã€ç§é’¥ã€å…¬é’¥
  - æ˜“æ”¯ä»˜ï¼šåŸŸåã€PIDã€å¯†é’¥

#### å¯é€‰é…ç½®ï¼š
- æ¨¡æ¿è¿‡æœŸæ—¶é—´
- åˆ†äº«ç é‡ç½®è§„åˆ™
- å…¶ä»–ä¸šåŠ¡é…ç½®

---

## ğŸ“¦ ç¬¬å…«æ­¥ï¼šå¯¼å…¥å•†å“æ•°æ®ï¼ˆå¯é€‰ï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç®¡ç†åå°

1. ç™»å½•ç®¡ç†åå°
2. è¿›å…¥"å•†å“ç®¡ç†"
3. ç‚¹å‡»"æ·»åŠ å•†å“"
4. å¡«å†™å•†å“ä¿¡æ¯å¹¶ä¿å­˜

### æ–¹æ³•äºŒï¼šæ‰¹é‡å¯¼å…¥ï¼ˆå¦‚æœæœ‰ CSV æ–‡ä»¶ï¼‰

```bash
# é¡¹ç›®ä¸­æœ‰ä¸€ä¸ª products.csv ç¤ºä¾‹æ–‡ä»¶
# å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹åå¯¼å…¥ï¼ˆéœ€è¦å¼€å‘å¯¼å…¥åŠŸèƒ½ï¼‰
```

---

## âœ… ç¬¬ä¹æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿ

### 1. æµ‹è¯•å‰ç«¯è®¿é—®

```bash
# è®¿é—®é¦–é¡µ
http://your-domain/h5/

# åº”è¯¥èƒ½çœ‹åˆ°å•†å“åˆ—è¡¨
```

### 2. æµ‹è¯•å¾®ä¿¡ç™»å½•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æˆ–æ‰‹æœºå¾®ä¿¡æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢ï¼Œæµ‹è¯•ç™»å½•åŠŸèƒ½

### 3. æµ‹è¯•è®¢å•æµç¨‹

1. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
2. åˆ›å»ºè®¢å•
3. ç”Ÿæˆåˆ†äº«é“¾æ¥
4. è®¿é—®åˆ†äº«é“¾æ¥
5. æµ‹è¯•æ”¯ä»˜ï¼ˆä½¿ç”¨æµ‹è¯•ç¯å¢ƒï¼‰

### 4. æµ‹è¯•ç®¡ç†åå°

1. ç™»å½•ç®¡ç†åå°
2. æµ‹è¯•å•†å“ç®¡ç†
3. æµ‹è¯•è®¢å•ç®¡ç†
4. æµ‹è¯•ç”¨æˆ·ç®¡ç†

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :4000
sudo lsof -i :4001

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹ç«¯å£
# ç¼–è¾‘ server/config/config.js å’Œ client/next.config.ts
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MySQL æ˜¯å¦è¿è¡Œ
sudo systemctl status mysql

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat server/config.json

# æµ‹è¯•è¿æ¥
mysql -u shop_user -p mini_shop
```

### é—®é¢˜ 3ï¼šå‰ç«¯é¡µé¢ç©ºç™½

```bash
# æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
# æ£€æŸ¥ API_URL é…ç½®
cat client/public/config.js

# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:4000/v1/shop/products

# æ¸…é™¤ç¼“å­˜é‡æ–°æ„å»º
cd client
rm -rf .next
npm run build
```

### é—®é¢˜ 4ï¼šæ”¯ä»˜å¤±è´¥

```bash
# æ£€æŸ¥æ”¯ä»˜é…ç½®
# ç™»å½•ç®¡ç†åå° -> ç³»ç»Ÿé…ç½® -> æŸ¥çœ‹æ”¯ä»˜é…ç½®

# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶ï¼ˆå¾®ä¿¡æ”¯ä»˜ï¼‰
# æ£€æŸ¥å›è°ƒ URL é…ç½®
# æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡/æ”¯ä»˜å®åå°é…ç½®äº†å›è°ƒåœ°å€
```

### é—®é¢˜ 5ï¼šå¾®ä¿¡ç™»å½•å¤±è´¥

```bash
# æ£€æŸ¥å¾®ä¿¡é…ç½®
# 1. AppID å’Œ AppSecret æ˜¯å¦æ­£ç¡®
# 2. æ˜¯å¦é…ç½®äº†æˆæƒåŸŸå
# 3. æ˜¯å¦æ·»åŠ äº†æœåŠ¡å™¨IPç™½åå•

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs shop-server
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æ—¥å¿—

```bash
# PM2 æ—¥å¿—
pm2 logs

# åªçœ‹åç«¯æ—¥å¿—
pm2 logs shop-server

# åªçœ‹å‰ç«¯æ—¥å¿—
pm2 logs shop-client

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯åç«¯
pm2 restart shop-server

# é‡å¯å‰ç«¯
pm2 restart shop-client

# é‡å¯æ‰€æœ‰
pm2 restart all

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u shop_user -p mini_shop > backup_$(date +%Y%m%d).sql

# å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz server/public/upload/

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp server/config.json config_backup_$(date +%Y%m%d).json
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®ŒæˆåŸºç¡€éƒ¨ç½²åï¼Œå»ºè®®ï¼š

1. âœ… **å®‰å…¨åŠ å›º**
   - å‚è€ƒã€Šå®‰å…¨éƒ¨ç½²æ£€æŸ¥æ¸…å•.mdã€‹
   - é…ç½®é˜²ç«å¢™
   - å¯ç”¨ HTTPS
   - æ·»åŠ ç›‘æ§

2. âœ… **æ€§èƒ½ä¼˜åŒ–**
   - é…ç½® CDN
   - å¯ç”¨ Redis ç¼“å­˜
   - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•

3. âœ… **æŒç»­ç›‘æ§**
   - é…ç½®ç›‘æ§å‘Šè­¦
   - å®šæœŸæ£€æŸ¥æ—¥å¿—
   - å®šæœŸå¤‡ä»½æ•°æ®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ã€Šå®‰å…¨å®¡æŸ¥æŠ¥å‘Š.mdã€‹- **å¿…è¯»**
- ã€ŠæŠ€æœ¯æ¶æ„åˆ†æ.mdã€‹- äº†è§£ç³»ç»Ÿæ¶æ„
- ã€Šå®‰å…¨éƒ¨ç½²æ£€æŸ¥æ¸…å•.mdã€‹- éƒ¨ç½²æ£€æŸ¥æ¸…å•
- ã€Šå®‰å…¨æ¸…ç†è„šæœ¬.shã€‹- è‡ªåŠ¨æ¸…ç†è„šæœ¬

---

## âš ï¸ é‡è¦æé†’

1. **æ­¤ç³»ç»Ÿç”¨äºç”Ÿæˆè™šå‡è®¢å•é¡µé¢ï¼Œè¯·å‹¿ç”¨äºè¿æ³•æ´»åŠ¨**
2. **éƒ¨ç½²å‰å¿…é¡»å®Œå…¨æ¸…ç†åé—¨ä»£ç **
3. **å»ºè®®è¿›è¡Œå…¨é¢çš„å®‰å…¨å®¡è®¡**
4. **å®šæœŸç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€**
5. **ä¿æŠ¤å¥½ç”¨æˆ·æ•°æ®å’Œæ”¯ä»˜å¯†é’¥**

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å®šä½é—®é¢˜
2. æœç´¢é”™è¯¯ä¿¡æ¯
3. æŸ¥é˜…ç›¸å…³æ–‡æ¡£
4. å’¨è¯¢ä¸“ä¸šæŠ€æœ¯äººå‘˜

**åˆ‡è®°ï¼šå®‰å…¨ç¬¬ä¸€ï¼Œåˆæ³•ä½¿ç”¨ï¼**

---

**æœ€åæ›´æ–°ï¼š** 2025-10-16  
**é€‚ç”¨ç‰ˆæœ¬ï¼š** ä¸‰ä¸ƒ 6.0 ç‰ˆæœ¬


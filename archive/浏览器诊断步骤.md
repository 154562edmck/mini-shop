# 🔍 浏览器端问题诊断步骤

## 重要！请先清除浏览器缓存

**原因**：浏览器可能缓存了旧的 `config.js` 文件（包含错误的API URL）

### Chrome/Edge清除缓存：
1. 按 `Ctrl + Shift + Delete`
2. 选择"缓存的图片和文件"
3. 时间范围选择"全部时间"
4. 点击"清除数据"

### 或者使用无痕模式：
- `Ctrl + Shift + N`（Chrome/Edge）
- `Ctrl + Shift + P`（Firefox）

---

## 📋 诊断步骤

### 步骤1: 打开主页并检查Console

1. 访问 `https://waimaimeituan.dpdns.org`
2. 按 `F12` 打开开发者工具
3. 切换到 **Console（控制台）** 标签
4. 刷新页面（`F5`）

**期望看到**：
```
APP_CONFIG {API_URL: 'https://waimaimeituan.dpdns.org/v1', ...}
getBaseUrl https://waimaimeituan.dpdns.org/v1
```

**如果看到**：
```
getBaseUrl http://localhost:3000/v1  ❌
```
→ 说明浏览器缓存了旧的 `config.js`，请强制刷新（`Ctrl + Shift + R`）

---

### 步骤2: 检查Network（网络）请求

1. 切换到 **Network（网络）** 标签
2. 刷新页面（`F5`）
3. 查看所有请求：

#### 检查点A: config.js
- 找到 `config.js` 请求
- 点击它，查看 **Response（响应）** 标签
- 确认内容是：
  ```javascript
  API_URL: window.location.origin + '/v1'  ✅
  ```
- 如果是旧内容（`localhost` 或 `/admin/v1`）→ **强制刷新** `Ctrl + Shift + R`

#### 检查点B: API请求
- 找到 `/v1/shop/categories` 或 `/v1/products` 请求
- 查看请求URL，应该是：
  ```
  https://waimaimeituan.dpdns.org/v1/shop/categories  ✅
  ```
  
  **不应该是**：
  ```
  http://localhost:4000/v1/...  ❌
  ```

- 查看状态码（Status）：
  - `200` → 成功 ✅
  - `404` → API路径不存在 ❌
  - `502` → Backend服务故障 ❌
  - `CORS error` → 跨域问题 ❌
  - `ERR_CONNECTION_REFUSED` → 无法连接 ❌

#### 检查点C: 响应内容
- 点击成功的API请求
- 查看 **Response** 标签
- 应该看到商品数据的JSON：
  ```json
  {
    "code": 200,
    "data": [...],
    "message": "success"
  }
  ```

---

### 步骤3: 检查后台管理

1. 访问 `https://waimaimeituan.dpdns.org/admin`
2. 按 `F12` 打开开发者工具
3. 切换到 **Network** 标签
4. 刷新页面

#### 检查点D: 静态文件
查找以下请求，应该全部是 `200`：
- `/admin/libs/vue.global.js` → 200 ✅
- `/admin/libs/index.css` → 200 ✅
- `/admin/libs/index.full.js` → 200 ✅
- `/admin/js/api.js` → 200 ✅

**如果是 404**：
1. 点击失败的请求，查看 **Preview** 标签
2. 记录错误信息
3. 检查Nginx配置是否正确转发 `/admin/` 路径

#### 检查点E: Console错误
查看 **Console** 标签，是否有：
- `Failed to load resource` → 静态文件404
- `Uncaught ReferenceError: Vue is not defined` → vue.global.js加载失败
- 任何红色错误信息

---

## 🎯 根据症状判断

### 症状1: 主页显示"加载数据失败"

**可能原因**：
1. ❌ API请求发送到 `localhost`（浏览器缓存问题）
   - **解决**：强制刷新 `Ctrl + Shift + R` 或清除缓存
   
2. ❌ API请求返回 404/502
   - **解决**：检查Nginx配置，确保 `/v1/` 正确代理到 `backend:4000`
   
3. ❌ 数据库无数据
   - **解决**：在后台添加商品和分类

---

### 症状2: 后台是空白页面

**可能原因**：
1. ❌ 静态文件404（`vue.global.js`、`index.css`等）
   - **解决**：检查 `server/public/admin/` 目录是否存在这些文件
   
2. ❌ Nginx没有正确代理 `/admin/` 到Backend
   - **解决**：检查 `nginx/conf.d/default.conf` 配置
   
3. ❌ JavaScript报错
   - **解决**：查看Console的具体错误信息

---

### 症状3: 后台可以打开，但无法登录

**可能原因**：
1. ❌ `/admin/api/auth/login` 请求失败
   - **解决**：检查Network中的API请求状态
   
2. ❌ Session配置问题
   - **解决**：检查Backend日志

---

## 🚀 服务器端快速测试

在服务器上运行（已经推送到GitHub）：

```bash
cd /opt/mini-shop
git pull
chmod +x test-all-endpoints.sh
./test-all-endpoints.sh
```

这会测试所有内部端点，帮助定位问题是在Nginx、Backend还是Frontend。

---

## 📞 请反馈以下信息

完成上述步骤后，请告诉我：

1. **Console中的 `APP_CONFIG` 和 `getBaseUrl` 输出是什么？**
   
2. **Network标签中失败的请求有哪些？** （状态码和URL）
   
3. **Console中有什么红色错误信息？**
   
4. **运行 `test-all-endpoints.sh` 的输出**（特别是哪些测试失败）

有了这些信息，我就能精准定位问题！🎯

